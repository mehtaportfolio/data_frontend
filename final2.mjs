import fs from 'fs'; const content = JSON.parse('\"import { Router, Request, Response } from \u0027express\u0027;\\nimport { supabase } from \u0027../utils/supabase.js\u0027;\\nimport { InsurancePolicy, ApiResponse } from \u0027../types/index.js\u0027;\\n\\nconst router = Router();\\n\\nasync function deleteFileFromStorage(fileUrl: string): Promise(void) {\\n  try {\\n    if (!fileUrl) return;\\n\\n    const urlParts = fileUrl.split(\u0027policy/\u0027);\\n    if (urlParts.length ( 2) return;\\n\\n    let filePath = urlParts[1];\\n    filePath = filePath.split(\u0027?\u0027)[0];\\n\\n    if (!filePath) return;\\n\\n    await supabase.storage.from(\u0027policy\u0027).remove([filePath]);\\n  } catch (error) {\\n    console.error(\u0027Failed to delete file from storage:\u0027, error);\\n  }\\n}\\n\\nrouter.get(\u0027/\u0027, async (req: Request, res: Response(ApiResponse(InsurancePolicy[]))) => {\\n  try {\\n    const { data, error } = await supabase\\n      .from(\u0027insurance_policies\u0027)\\n      .select(\u0027*\u0027)\\n      .order(\u0027created_at\u0027, { ascending: false });\\n\\n    if (error) {\\n      return res.status(500).json({\\n        success: false,\\n        error: `Failed to fetch insurance policies: ${error.message}`,\\n      });\\n    }\\n\\n    res.json({ success: true, data: data || [] });\\n  } catch (err: unknown) {\\n    const errorMessage = err instanceof Error ? err.message : \u0027Internal server error\u0027;\\n    res.status(500).json({\\n      success: false,\\n      error: errorMessage,\\n    });\\n  }\\n});\\n\\nrouter.post(\u0027/\u0027, async (req: Request, res: Response(ApiResponse(InsurancePolicy))) => {\\n  try {\\n    const { data, error } = await supabase\\n      .from(\u0027insurance_policies\u0027)\\n      .insert(req.body)\\n      .select()\\n      .single();\\n\\n    if (error) {\\n      return res.status(500).json({\\n        success: false,\\n        error: `Failed to create insurance policy: ${error.message}`,\\n      });\\n    }\\n\\n    res.status(201).json({ success: true, data });\\n  } catch (err: unknown) {\\n    const errorMessage = err instanceof Error ? err.message : \u0027Internal server error\u0027;\\n    res.status(500).json({\\n      success: false,\\n      error: errorMessage,\\n    });\\n  }\\n});\\n\\nrouter.put(\u0027/:id\u0027, async (req: Request, res: Response(ApiResponse(InsurancePolicy))) => {\\n  try {\\n    const { id } = req.params;\\n\\n    const { data, error } = await supabase\\n      .from(\u0027insurance_policies\u0027)\\n      .update(req.body)\\n      .eq(\u0027id\u0027, id)\\n      .select()\\n      .single();\\n\\n    if (error) {\\n      return res.status(500).json({\\n        success: false,\\n        error: `Failed to update insurance policy: ${error.message}`,\\n      });\\n    }\\n\\n    res.json({ success: true, data });\\n  } catch (err: unknown) {\\n    const errorMessage = err instanceof Error ? err.message : \u0027Internal server error\u0027;\\n    res.status(500).json({\\n      success: false,\\n      error: errorMessage,\\n    });\\n  }\\n});\\n\\nrouter.delete(\u0027/:id\u0027, async (req: Request, res: Response(ApiResponse(null))) => {\\n  try {\\n    const { id } = req.params;\\n\\n    const { data } = await supabase\\n      .from(\u0027insurance_policies\u0027)\\n      .select(\u0027policy_document\u0027)\\n      .eq(\u0027id\u0027, id)\\n      .single();\\n\\n    if (data?.policy_document) {\\n      await deleteFileFromStorage(data.policy_document);\\n    }\\n\\n    const { error } = await supabase.from(\u0027insurance_policies\u0027).delete().eq(\u0027id\u0027, id);\\n\\n    if (error) {\\n      return res.status(500).json({\\n        success: false,\\n        error: `Failed to delete insurance policy: ${error.message}`,\\n      });\\n    }\\n\\n    res.json({ success: true });\\n  } catch (err: unknown) {\\n    const errorMessage = err instanceof Error ? err.message : \u0027Internal server error\u0027;\\n    res.status(500).json({\\n      success: false,\\n      error: errorMessage,\\n    });\\n  }\\n});\\n\\nexport default router;\\n\"'); fs.writeFileSync('src/server/src/routes/insurancePolicies.ts', content); console.log('Done'); 
